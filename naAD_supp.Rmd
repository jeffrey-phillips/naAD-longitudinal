---
title: "Supplementary Material: Longitudinal progression of grey matter atrophy in non-amnestic Alzheimer's disease"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
header-includes:
  \usepackage{graphicx}
  \usepackage{morefloats}
  \usepackage{caption}
  \usepackage{lscape}
  \usepackage{siunitx}
  \newcommand{\blandscape}{\begin{landscape}}
  \newcommand{\elandscape}{\end{landscape}}
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
  html_document:
    fig_caption: yes
    force_captions: yes
    highlight: pygments
    number_sections: yes
    theme: cerulean
bibliography: naAD_long.bib
csl: neurology.csl
---

```{r supp_setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(fig.path='fig/', warning=FALSE, message=FALSE)
library(knitcitations); cleanbib()
cite_options(citation_format = "pandoc", check.entries=FALSE)
library(bibtex);library(xtable);library(pander);library(psych);library(knitr);
library(sciplot);library(nlme);library(lme4);library(gridExtra);library(doBy);
library(plyr);library(ANTsR);library(bestglm);library(leaps);library(ggplot2);
library(gplots); library(gee); library(ROCR); library(multcomp)
```

\captionsetup{labelformat=empty}

# Neuropsychological performance at time of initial MRI {-}

```{r print_npsy_base_phoc, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

tmptab<-npsy_base_phoc
tmptab$G1<-as.character(tab1df$Group2[match(tmptab$G1,tab1df$Group)])
tmptab$G2<-as.character(tab1df$Group2[match(tmptab$G2,tab1df$Group)])
tmptab$Effect<-ifelse(tmptab$Estimate>0,
	paste(tmptab$G1,tmptab$G2,sep='>'),
	paste(tmptab$G1,tmptab$G2,sep='<'))
w<-which(npsy_base_phoc$Estimate==0)
tmptab$Effect[w]<-paste(tmptab$G1[w],tmptab$G2[w],
	sep='==')

tmptab<-tmptab[,c('V','Effect','U','Estimate','LB','UB','P','Padj')]
tmptab$Estimate<-sprintf('%.2g',tmptab$Estimate)
tmptab$LB<-sprintf('%.2g',tmptab$LB)
tmptab$UB<-sprintf('%.2g',tmptab$UB)
tmptab$P<-sprintf('%.2g',tmptab$P)
tmptab$Padj<-sprintf('%.2g',tmptab$Padj)
tmptab$V<-gsub('base_ageatMRI','Age at initial MRI',tmptab$V)
tmptab$V<-gsub('base_MMSETotal','Initial MMSE',tmptab$V)
tmptab$V<-gsub('BehavioralScale','PBAC social behavior',tmptab$V)
tmptab$V<-gsub('FLetterFluency','Letter fluency (F words)',tmptab$V)
tmptab$V<-gsub('ForwardSpan','Forward digit span',tmptab$V)
tmptab$V<-gsub('ReverseSpan','Reverse digit span',tmptab$V)
tmptab$V<-gsub('JOLO','Judgment of line orientation',tmptab$V)
tmptab$V<-gsub('OralTrails','Oral Trails',tmptab$V)
tmptab$V<-gsub('ReyCopy','Rey figure copy',tmptab$V)
tmptab$V<-gsub('Speech', 'PBAC speech',tmptab$V)
tmptab$V[duplicated(tmptab$V)]<-''

xnpsy_base_phoc<-xtable(tmptab,
	caption='Supplementary Table 1. Post-hoc comparisons of between group differences for neuropsychological assessments at time of initial MRI. P-values are given both before and after multiple-comparisons correction using FDR.',
	align='lllrrrrll',digits=0)
wsig<-which(as.numeric(xnpsy_base_phoc$Padj)<0.05)
xnpsy_base_phoc$Effect[wsig]<-paste('\\textbf{',xnpsy_base_phoc$Effect[wsig],'}',sep='')
xnpsy_base_phoc$U[wsig]<-paste('\\textbf{',xnpsy_base_phoc$U[wsig],'}',sep='')
xnpsy_base_phoc$Estimate[wsig]<-paste('\\textbf{',xnpsy_base_phoc$Estimate[wsig],'}',sep='')
xnpsy_base_phoc$LB[wsig]<-paste('\\textbf{',xnpsy_base_phoc$LB[wsig],'}',sep='')
xnpsy_base_phoc$UB[wsig]<-paste('\\textbf{',xnpsy_base_phoc$UB[wsig],'}',sep='')
xnpsy_base_phoc$P[wsig]<-paste('\\textbf{',xnpsy_base_phoc$P[wsig],'}',sep='')
xnpsy_base_phoc$Padj[wsig]<-paste('\\textbf{',xnpsy_base_phoc$Padj[wsig],'}',sep='')
names(xnpsy_base_phoc)<-c('Measure','Effect','Mann-Whitney U','Estimated difference',
	'Lower bound','Upper bound','P','$P_{adj}$')
print(xnpsy_base_phoc,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.67)

```

# Longitudinal neuropsychological performance {-}
```{r plots_npsych, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE, fig.align='center',fig.width=7.5,fig.height=8,fig.path='./fig/',fig.cap='Supplementary Figure 1. Longitudinal change in neuropsychological performance. The x-axis indicates time (in years) from the first available assessment.'}

# Run linear mixed effects models to investigate neuropsych change over time.
npsymodels<-vector(mode='list',length=length(cogvar))
names(npsymodels)<-cogvar
i<-1

mrecog<-lme(Recognition~Group*Time+BaseAge,random=~1|INDDID,data=recog,
	na.action=na.exclude)
npsymodels[[i]]<-mrecog
i<-i+1

mspeech<-lme(Speech~Group*Time+BaseAge,random=~1|INDDID,data=pbac,
	na.action=na.exclude)
npsymodels[[i]]<-mspeech
i<-i+1

mflet<-lme(FLetterFluency~Group*Time+BaseAge,random=~1|INDDID,data=flet,
	na.action=na.exclude)
npsymodels[[i]]<-mflet
i<-i+1

mfspan<-lme(ForwardSpan~Group*Time+BaseAge,random=~1|INDDID,data=digsp,
	na.action=na.exclude)
npsymodels[[i]]<-mfspan
i<-i+1

mrey<-lme(ReyCopy~Group*Time+BaseAge,random=~1|INDDID,data=pbac,
	na.action=na.exclude)
npsymodels[[i]]<-mrey
i<-i+1

mjolo<-lme(JOLO~Group*Time+BaseAge,random=~1|INDDID,data=pbac,
	na.action=na.exclude)
npsymodels[[i]]<-mjolo
i<-i+1	

mbhav<-lme(BehavioralScale~Group*Time+BaseAge,random=~1|INDDID,data=pbac,
	na.action=na.exclude)
npsymodels[[i]]<-mbhav
i<-i+1

mtrails<-lme(OralTrails~Group*Time+BaseAge,random=~1|INDDID,data=pbac,
	na.action=na.exclude)
npsymodels[[i]]<-mtrails
i<-i+1

mrspan<-lme(ReverseSpan~Group*Time+BaseAge,random=~1|INDDID,data=digsp,
	na.action=na.exclude)
npsymodels[[i]]<-mrspan
i<-i+1

knpsy<-kmat[,c(1:7,10:13)]
rownames(knpsy)<-gsub('g0_Control','lvPPA',rownames(knpsy))
rownames(knpsy)<-gsub('g1_lvPPA','PCA',rownames(knpsy))
rownames(knpsy)<-gsub('g2_PCA','aAD',rownames(knpsy))
rownames(knpsy)<-gsub('g3_aAD','fvAD',rownames(knpsy))
rownames(knpsy)<-gsub('g4_fvAD','Controls',rownames(knpsy))

npsyttab<-data.frame()
npsyanova<-data.frame()
phocnpsy<-data.frame()
pmatnpsy<-matrix(nrow=5,ncol=length(cogvar))

for (i in 1:length(npsymodels)) {

	# Store fixed effects results.
	m<-npsymodels[[i]]
	tmp<-as.data.frame(summary(m)$tTable,stringsAsFactors=F)
	tmp$Effect<-rownames(tmp);tmp$Task<-cogvar[i]
	npsyttab<-rbind(npsyttab,tmp)

	# Store anova results.
	am<-anova(m)
	pmatnpsy[,i]<-anova(m)$"p-value"
	fg<-round(am[2,3],1);fgt<-round(am[5,3],1)
	tmp<-data.frame(Task=cogvar[i],Group=fg,Group_x_time=fgt,stringsAsFactors=F)
	npsyanova<-rbind(npsyanova,tmp)

	# Post-hoc contrasts
	comp <- glht(m, linfct=knpsy)
	scomp<-summary(comp,test=adjusted('fdr'))
	tmp<-data.frame(Task=cogvar[i],Comp=names(scomp$test$pvalues),
		Z=scomp$test$tstat,P=scomp$test$pvalues,stringsAsFactors=F)
	phocnpsy<-rbind(phocnpsy,tmp)
}

pmatnpsy<-t(pmatnpsy);
padjnpsy<-apply(pmatnpsy,2,function(x) { p.adjust(x,method='fdr') })
phocnpsy$Comp<-as.character(phocnpsy$Comp)
phocnpsy$G1<-NA;phocnpsy$G2<-NA
for (i in 1:nrow(phocnpsy)) {
	s<-unlist(strsplit(phocnpsy$Comp[i],'-'))
	phocnpsy$G1[i]<-unlist(strsplit(s[1],'_'))[2]
	phocnpsy$G2[i]<-s[2]
}
rownames(phocnpsy)<-1:nrow(phocnpsy)

# Make line plots of longitudinal change per group.
plotcols<-c('g1_lvPPA'=colscheme2[2],'g2_PCA'=colscheme2[3],
	'g3_aAD'=colscheme2[1],'g4_fvAD'=colscheme2[4],'g0_Control'='grey50')

recogplot<-ggplot(data=recog,
	aes(x=Time,y=Recognition,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Discrimination (0--1)',
		title='Recognition')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/recog.png',plot=recogplot)

speechplot<-ggplot(data=pbac,
	aes(x=Time,y=Speech,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Score (0-4)',
		title='PBAC speech')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/speech.png',plot=speechplot)

reyplot<-ggplot(data=pbac,
	aes(x=Time,y=ReyCopy,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Features copied',
		title='PBAC Rey figure copy')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/rey.png',plot=reyplot)

joloplot<-ggplot(data=pbac,
	aes(x=Time,y=JOLO,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='JOLO score',
		title='Judgment of line orientation')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/jolo.png',plot=joloplot)

bhavplot<-ggplot(data=pbac,
	aes(x=Time,y=BehavioralScale,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Behavioral score (0-18)',
		title='PBAC social behavior')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/bhav.png',plot=bhavplot)

trailsplot<-ggplot(data=pbac,
	aes(x=Time,y=OralTrails,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Oral trails score',
		title='PBAC oral Trails')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/trails.png',plot=trailsplot)

fletplot<-ggplot(data=flet,
	aes(x=Time,y=FLetterFluency,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Words produced (0+)',
		title='Letter fluency (F words)')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/flet.png',plot=fletplot)

fspanplot<-ggplot(data=digsp,
	aes(x=Time,y=ForwardSpan,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Maximum span (0+)',
		title='Forward digit span')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/fspan.png',plot=fspanplot)

rspanplot<-ggplot(data=digsp,
	aes(x=Time,y=ReverseSpan,color=Group,shape=Group))+
	guides(shape='none',color='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols)+
	labs(x='Time (years)',y='Maximum span (0+)',
		title='Reverse digit span')+
	theme(plot.title=element_text(hjust=0.5))
#ggsave(filename='fig/rspan.png',plot=rspanplot)

tmpdf<-recog
tmpdf$Group<-unlist(lapply(tmpdf$Group,function(x) { unlist(strsplit(as.character(x),
	'_'))[2] } ))
tmpdf$Group<-factor(tmpdf$Group,levels=c('lvPPA','PCA','aAD','fvAD','Control'))
plotcols2<-plotcols
names(plotcols2)<-levels(tmpdf$Group)

legplot<-ggplot(data=tmpdf,
	aes(x=Time,y=Recognition,color=Group,shape=Group))+
	guides(shape='none')+
	geom_smooth(method='lm',na.rm=T)+
	scale_colour_manual(values=plotcols2)+
	labs(x='Time (years)',y='Discrimination (0-1)',
		title='Recognition')+
	theme(plot.title=element_text(hjust=0.5),
		legend.position='bottom')
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(legplot)

grid.arrange(arrangeGrob(recogplot,speechplot,fletplot,fspanplot,reyplot,joloplot,bhavplot,
	trailsplot,rspanplot,nrow=3),mylegend,nrow=2,heights=c(7.5,0.5))
	
```

```{r long_recog_phoc, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

tmptab<-subset(phocnpsy,phocnpsy$Task=='Recognition')
tmptab$Effect<-ifelse(grepl('mean',tmptab$Comp),'Group mean','Group x time')
tmptab$Comparison<-ifelse(tmptab$Z>0,paste(tmptab$G1,'>',tmptab$G2,sep=''),
	paste(tmptab$G1,'<',tmptab$G2,sep=''))
tmptab$Z<-sprintf('%.1f',abs(tmptab$Z))
tmptab$P<-sprintf('%.2g',tmptab$P)
tmptab<-tmptab[,c('Effect','Comparison','Z','P')]
tmptab$Effect[duplicated(tmptab$Effect)]<-''

xlong_recog<-xtable(tmptab,
	caption='Supplementary Table 2. Post-hoc comparisons of longitudinal recognition discrimination. Group mean: cross-sectional differences in average group performance, independent of time. Group x time: differences in rate of longitudinal cognitive change. P-values are FDR-corrected, with a significance threshold of p<0.05.',
	align='lllrr',digits=0)
wsig<-which(as.numeric(xlong_recog$P)<0.05)
xlong_recog$Comparison[wsig]<-paste('\\textbf{',xlong_recog$Comparison[wsig],
	'}',sep='')
xlong_recog$Z[wsig]<-paste('\\textbf{',xlong_recog$Z[wsig],'}',sep='')
xlong_recog$P[wsig]<-paste('\\textbf{',xlong_recog$P[wsig],'}',sep='')
print(xlong_recog,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.75)

```

```{r long_lang_phoc, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

tmptab<-subset(phocnpsy,phocnpsy$Task %in% c('Speech','ForwardSpan',
	'FLetterFluency'))
tmptab$Effect<-ifelse(grepl('mean',tmptab$Comp),'Group mean','Group x time')
tmptab$Comparison<-ifelse(tmptab$Z>0,paste(tmptab$G1,'>',tmptab$G2,sep=''),
	paste(tmptab$G2,'>',tmptab$G1,sep=''))
tmptab$Z<-sprintf('%.1f',abs(tmptab$Z))
tmptab$P<-sprintf('%.2g',tmptab$P)
tmptab<-tmptab[,c('Task','Effect','Comparison','Z','P')]
tmpeff<-tmptab$Effect
tmpeff[duplicated(tmptab[,c('Task','Effect')])]<-''
tmptab$Task[duplicated(tmptab$Task)]<-''
tmptab$Effect<-tmpeff

xlong_lang<-xtable(tmptab,
	caption='Supplementary Table 3. Post-hoc comparisons of longitudinal language performance. Group mean: cross-sectional differences in average group performance, independent of time. Group x time: differences in rate of longitudinal cognitive change. P-values are FDR-corrected, with a significance threshold of p<0.05.',align='llllrr',digits=0)
wsig<-which(as.numeric(xlong_lang$P)<0.05)
xlong_lang$Comparison[wsig]<-paste('\\textbf{',xlong_lang$Comparison[wsig],
	'}',sep='')
xlong_lang$Z[wsig]<-paste('\\textbf{',xlong_lang$Z[wsig],'}',sep='')
xlong_lang$P[wsig]<-paste('\\textbf{',xlong_lang$P[wsig],'}',sep='')
print(xlong_lang,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.75)

```

```{r long_vis_phoc, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

tmptab<-subset(phocnpsy,phocnpsy$Task %in% c('ReyCopy','JOLO'))
tmptab$Effect<-ifelse(grepl('mean',tmptab$Comp),'Group mean','Group x time')
tmptab$Comparison<-ifelse(tmptab$Z>0,paste(tmptab$G1,'>',tmptab$G2,sep=''),
	paste(tmptab$G2,'>',tmptab$G1,sep=''))
tmptab$Z<-sprintf('%.1f',abs(tmptab$Z))
tmptab$P<-sprintf('%.2g',tmptab$P)
tmptab<-tmptab[,c('Task','Effect','Comparison','Z','P')]
tmpeff<-tmptab$Effect
tmpeff[duplicated(tmptab[,c('Task','Effect')])]<-''
tmptab$Task[duplicated(tmptab$Task)]<-''
tmptab$Effect<-tmpeff

xlong_vis<-xtable(tmptab,
	caption='Supplementary Table 4. Post-hoc comparisons of longitudinal visuospatial performance. Group mean: cross-sectional differences in average group performance, independent of time. Group x time: differences in rate of longitudinal cognitive change. P-values are FDR-corrected, with a significance threshold of p<0.05.',align='llllrr',digits=0)
wsig<-which(as.numeric(xlong_vis$P)<0.05)
xlong_vis$Comparison[wsig]<-paste('\\textbf{',xlong_vis$Comparison[wsig],
	'}',sep='')
xlong_vis$Z[wsig]<-paste('\\textbf{',xlong_vis$Z[wsig],'}',sep='')
xlong_vis$P[wsig]<-paste('\\textbf{',xlong_vis$P[wsig],'}',sep='')
print(xlong_vis,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.75)

```

```{r long_soc_exec_phoc, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

tmptab<-subset(phocnpsy,phocnpsy$Task %in% c('BehavioralScale','OralTrails','ReverseSpan'))
tmptab$Effect<-ifelse(grepl('mean',tmptab$Comp),'Group mean','Group x time')
tmptab$Comparison<-ifelse(tmptab$Z>0,paste(tmptab$G1,'>',tmptab$G2,sep=''),
	paste(tmptab$G2,'>',tmptab$G1,sep=''))
tmptab$Z<-sprintf('%.1f',abs(tmptab$Z))
tmptab$P<-sprintf('%.2g',tmptab$P)
tmptab<-tmptab[,c('Task','Effect','Comparison','Z','P')]
tmpeff<-tmptab$Effect
tmpeff[duplicated(tmptab[,c('Task','Effect')])]<-''
tmptab$Task[duplicated(tmptab$Task)]<-''
tmptab$Effect<-tmpeff

xlong_soc_exec<-xtable(tmptab,caption='Supplementary Table 5. Post-hoc comparisons of longitudinal behavioral and executive function. Group mean: cross-sectional differences in average group performance, independent of time. Group x time: differences in rate of longitudinal cognitive change. P-values are FDR-corrected, with a significance threshold of p<0.05.',align='llllrr',digits=0)
wsig<-which(as.numeric(xlong_soc_exec$P)<0.05)
xlong_soc_exec$Comparison[wsig]<-paste('\\textbf{',xlong_soc_exec$Comparison[wsig],
	'}',sep='')
xlong_soc_exec$Z[wsig]<-paste('\\textbf{',xlong_soc_exec$Z[wsig],'}',sep='')
xlong_soc_exec$P[wsig]<-paste('\\textbf{',xlong_soc_exec$P[wsig],'}',sep='')
print(xlong_soc_exec,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.75)

```

\begin{figure}[]
% Voxelwise associations with age and MMSE.

{\centering \includegraphics[width=7in]{./fig/age_mmse.pdf} 

}

\caption[Age and global cognition associations]{Supplementary Figure 2. Voxelwise associations of cortical thickness with age and MMSE score at initial MRI. Image overlays are t-statistic maps from linear mixed effects (LME) models, thresholded at voxelwise p<0.001 with a minimum cluster volume of \SI{560}{\micro\litre}, corresponding to a corrected cluster-wise threshold of p<0.05. Warm colors indicate that cortical thickness over time is positively associated with each variable; cool colors indicate inverse associations. \label{age_mmse}}

\end{figure}

# Voxelwise analysis of cortical thinning {-}

```{r vox_vs_controls, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

flist<-c('time_Control_aAD_clust.nii.gz','time_Control_fvAD_clust.nii.gz',
	'time_Control_lvPPA_clust.nii.gz','time_Control_PCA_clust.nii.gz',
	'time_Control_aAD_p01_clust.nii.gz',
	'time_Control_fvAD_p01_clust.nii.gz',
	'time_Control_lvPPA_p01_clust.nii.gz',
	'time_Control_PCA_p01_clust.nii.gz')
baseflist<-c('base_aAD_Control_clust.nii.gz','base_fvAD_Control_clust.nii.gz',
	'base_lvPPA_Control_clust.nii.gz','base_PCA_Control_clust.nii.gz',
	'base_aAD_Control_tstat_p01_clust.nii.gz',
	'base_fvAD_Control_tstat_p01_clust.nii.gz',
	'base_lvPPA_Control_tstat_p01_clust.nii.gz',
	'base_PCA_Control_tstat_p01_clust.nii.gz')
olapflist<-gsub('time','olap',flist)

for (i in 1:length(flist)) {
	f<-flist[i]
	basef<-baseflist[i]
	fout<-gsub('time','olap',f)
	cmd<-paste("3dcalc -a",basef,"-b",f,"-expr 'step(-1*a)*step(b)' -overwrite -prefix",
		fout)
	system(cmd)
	cmd<-paste("fslswapdim",fout,"x z -y",gsub('.nii','_RPI.nii',fout))
	system(cmd)
}

#system('3dZeropad -I -35 -S -20 -R -18 -L -18 -P -16 -A -16 -prefix T_template0_JLF_crop.nii.gz T_template0_JLF.nii.gz')
#system('3dresample -master mean_Control_aAD_20180507_clust.nii.gz -prefix T_template0_JLF_crop_2mm.nii.gz -inset T_template0_JLF_crop.nii.gz')
#jlf<-antsImageRead('T_template0_JLF_crop_2mm.nii.gz',3)
jlf<-antsImageRead('T_template0_JLF_crop.nii.gz',3)
jlfhyp<-maskImage(img.in=jlf,img.mask=jlf,level=hyplabs)
#antsImageWrite(image=jlfhyp,filename='T_template0_JLF_crop_2mm_hyplabs.nii.gz')
regpeaks<-data.frame()
for (fn in c(baseflist[1:4],flist[1:4],olapflist[1:4])) {
	s<-unlist(strsplit(fn,'_'))
	eff<-s[1]
	g1<-s[2]
	g2<-s[3]
	fnout<-gsub('.nii','_jlf.nii',fn)
	fnout<-gsub('_clust','',fnout)
	img<-antsImageRead(fn,3)
	if (grepl('base',fnout)) {
		bin<-thresholdImage(img,lothresh=-1000,hithresh=-1)
	} else if (grepl('time',fnout)) {
		bin<-thresholdImage(img,lothresh=1,hithresh=1000)
	} else if (grepl('olap',fnout)) {
		bin<-thresholdImage(img,lothresh=1,hithresh=1)
	}
	x<-maskImage(img.in=jlf,img.mask=bin)
	imask<-maskImage(img.in=img,img.mask=bin)
	antsImageWrite(image=x,filename=fnout)
	xnum<-as.numeric(x)
	inum<-as.numeric(imask)
	vals<-sort(unique(xnum[xnum>0]))
	for (v in vals) {
		w<-which(xnum==v)
		tmp<-data.frame(Effect=eff,G1=g1,G2=g2,LabelID=v,NVox=length(w),
			Min=min(inum[w]),Median=median(inum[w]),Mean=mean(inum[w]),
			Max=max(inum[w]),InputFile=fn,stringsAsFactors=F)
		regpeaks<-rbind(regpeaks,tmp)
	}
	gc()
}
system('for f in *jlf.nii.gz; do fslswapdim $f x z -y ${f/.nii/_RPI.nii}; done')

peaktab<-data.frame(LabelID=sort(unique(regpeaks$LabelID)))
peaktab$Label.Name<-roi$Label.Name[match(peaktab$LabelID,roi$LabelID)]
peaktab<-subset(peaktab,!peaktab$LabelID<100)

for (g in c('aAD','lvPPA','PCA','fvAD')) {
	basesub<-subset(regpeaks,regpeaks$Effect=='base' & regpeaks$G1==g)
	if (nrow(basesub)>0) {
		peaktab[,paste(g,'base',sep='.')]<-basesub$Min[match(peaktab$LabelID,
			basesub$LabelID)]
		peaktab[,paste(g,'basevox',sep='.')]<-basesub$NVox[match(peaktab$LabelID,
			basesub$LabelID)]
	}
	timesub<-subset(regpeaks,regpeaks$Effect=='time' & regpeaks$G2==g)
	if (nrow(timesub)>0) {
		peaktab[,paste(g,'time',sep='.')]<-timesub$Max[match(peaktab$LabelID,
			timesub$LabelID)]
		peaktab[,paste(g,'timevox',sep='.')]<-timesub$NVox[match(peaktab$LabelID,
			timesub$LabelID)]
	}
	olapsub<-subset(regpeaks,regpeaks$Effect=='olap' & regpeaks$G2==g)
	if (nrow(olapsub)>0) {
		peaktab[,paste(g,'olap',sep='.')]<-olapsub$Max[match(peaktab$LabelID,
			olapsub$LabelID)]
		peaktab[,paste(g,'olapvox',sep='.')]<-olapsub$NVox[match(peaktab$LabelID,
			olapsub$LabelID)]
	}
}

for (cn in grep('vox',names(peaktab))) {
	w<-which(is.na(peaktab[,cn]))
	peaktab[w,cn]<-'---'
}

cnround<-setdiff(c(grep('base',names(peaktab)),grep('time',names(peaktab))),
	grep('vox',names(peaktab)))
for (cn in cnround) {
	peaktab[,cn]<-sprintf('%.1f',peaktab[,cn])
	w<-which(peaktab[,cn]=='NA')
	peaktab[w,cn]<-'---'
}

xbasepeaktab<-xtable(peaktab[,c(2,grep('base',names(peaktab)))],
	caption='Supplementary Table 6. Peak effects of initial cortical thinning for each patient group relative to controls. Reported values are t-statistics for the peak voxel (local minimum) within each anatomically-defined region at a cluster-wise significance threshold of p<0.05, as well as the volume of statistically significant voxels in microliters.',
	align=c('l','l',rep('r',8)),digits=0)

names(xbasepeaktab)<-c('Region','aAD: $T_{init}$','aAD: $Vol_{init}$',
	'lvPPA: $T_{init}$','lvPPA: $Vol_{init}$',
	'PCA: $T_{init}$','PCA: $Vol_{init}$',
	'fvAD: $T_{init}$','fvAD: $Vol_{init}$')

print(xbasepeaktab,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.5)

# Z-statistic thresholds for contrasts vs. controls corresponding to either 
# FDR-corrected q<0.05 or q<0.01, if q<0.05 threshold was lower than that for
# uncorrected p<0.05. 
s<-'
8 mean_Control_lvPPA q05 2.027
10 mean_Control_PCA q01 2.499
12 mean_Control_aAD q05 2.551
14 mean_Control_fvAD q01 2.653
28 time_Control_lvPPA q01 2.473
30 time_Control_PCA q05 2.057
32 time_Control_aAD q05 2.425
34 time_Control_fvAD q05 4.010
'
tmp<-as.data.frame(t(matrix(data=scan(text=s,what=character()),nrow=4)))
k<-70
for (i in 1:nrow(tmp)) {
	outfile<-paste(tmp$V2[i],'_z',tmp$V4[i],'_',tmp$V3[i],'.nii.gz',sep='')
	cmd<-paste('3dmerge -overwrite -dxyz=1 -1clust 1.75 ',k,' -1dindex ',
		tmp$V1[i],' -1tindex ',tmp$V1[i],' -2thresh -',tmp$V4[i],' ',tmp$V4[i],
		' -prefix ',outfile,' long_lme_ctx_20180530+orig',sep='')
	system(cmd)
	cmd<-paste('3dresample -master T_template0_BrainCerebellum_crop.nii.gz -prefix ',
		outfile,' -inset ',outfile,' -overwrite',sep='')
	system(cmd)
	cmd<-paste('fslswapdim ',outfile,' x z -y ',gsub('.nii','_RPI.nii',outfile))
	system(cmd)
}

```

```{r long_peaktab, eval=TRUE, echo=FALSE, include=TRUE, results='asis',autodep=TRUE}

xlongpeaktab<-xtable(peaktab[,c(2,grep('time',names(peaktab)))],
	caption='Supplementary Table 7. Peak effects for contrasts of longitudinal change over time for each patient group relative to controls. Reported values are t-statistics for the peak voxel (local maximum) within each anatomically-defined region at a cluster-wise significance threshold of p<0.05, as well as the volume of statistically significant voxels in microliters.',
	align=c('l','l',rep('r',8)),digits=0)

names(xlongpeaktab)<-c('Region','aAD: $T_{long}$','aAD: $Vol_{long}$',
	'lvPPA: $T_{long}$','lvPPA: $Vol_{long}$',
	'PCA: $T_{long}$','PCA: $Vol_{long}$',
	'fvAD: $T_{long}$','fvAD: $Vol_{long}$')

print(xlongpeaktab,comment=FALSE,caption.placement='top',floating=T,
	include.rownames=F,sanitize.text.function=identity,
	sanitize.colnames.function=identity,scalebox=0.5)
```

\begin{figure}[]
% Voxelwise cortical thickness versus controls, uncorrected.

{\centering \includegraphics[width=7in]{./fig/me_time_p01.pdf} 

}

\caption[GM time effects]{Supplementary Figure 3. Voxelwise differences in cortical thickness relative to matched controls at a threshold of p<0.01, uncorrected for multiple comparisons. Results are for the same contrasts as shown in Figure 3, main text. Image overlays are binarized t-statistic maps for simple contrasts of controls minus each patient group. Blue: simple effect of group (patients<controls) from cross-sectional analysis of participants' initial MRI scans; red: group x time interaction from longitudinal LME models, indicating where patients have more rapid cortical thinning than controls; green: overlap between group and group x time effects. All results are displayed with a minimum cluster volume of \SI{560}{\micro\litre}. \label{gm_me_time}}

\end{figure}


